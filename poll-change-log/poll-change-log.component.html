<div [@routerTransition]>
    <sub-header [title]="'PollChangeLog' | localize">
        <div role="actions">
            <button (click)="back()" class="btn btn-primary">
                <span>{{ 'Back' | localize }}</span>
                <i class="fa fa-arrow-alt-left mx-2"></i>
            </button>
        </div>
    </sub-header>

    <div [class]="containerClass">
        <div class="card card-custom gutter-b">
            <div class="card-body">
                <form class="form" autocomplete="off">
                    <div>
                        <div class="row align-items-center">
                            <div class="col-xl-12">
                                <div class="form-group m-form__group align-items-center mb-5">
                                    <div class="input-group search-input-group">
                                        <input
                                            [(ngModel)]="propertyName"
                                            name="filter"
                                            autoFocus
                                            class="form-control m-input"
                                            [placeholder]="l('Property')"
                                            type="text" />
                                        <span class="input-group-btn">
                                            <button (click)="getList()" class="btn btn-primary" type="submit">
                                                <i class="fa fa-magnifying-glass"></i>
                                            </button>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row" [hidden]="!advancedFiltersAreShown">
                            <div class="col-md-12">
                                <div class="kt-separator kt-separator--border-dashed"></div>
                            </div>
                            <div class="col-sm-6 col-md-3">
                                <div class="form-group">
                                    <label for="MinStartDateFilter">{{ l('StartDateRange') }}</label>
                                    <div class="input-group">
                                        <span class="input-group-text" (click)="dpsR.open()">
                                            <span class="fa fa-calendar-day"></span>
                                        </span>
                                        <mat-date-range-input
                                            [rangePicker]="dpsR"
                                            class="form-control"
                                            (click)="dpsR.open()">
                                            <input
                                                matStartDate
                                                placeholder="{{ l('MinValue') }}"
                                                [(ngModel)]="startDate"
                                                name="minStartDate"
                                                readonly />
                                            <input
                                                matEndDate
                                                placeholder="{{ l('MaxValue') }}"
                                                [(ngModel)]="endDate"
                                                name="maxStartDate"
                                                readonly />
                                        </mat-date-range-input>
                                        <mat-date-range-picker #dpsR></mat-date-range-picker>
                                        <span
                                            class="input-group-text"
                                            *ngIf="startDate || endDate"
                                            (click)="startDate = undefined; endDate = undefined">
                                            <span class="fa fa-times"></span>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6 col-md-3">
                                <div class="form-group">
                                    <label for="reason">{{ l('Reason') }}</label>
                                    <div class="input-group">
                                        <input type="text" [(ngModel)]="reason" name="reason" class="form-control" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-6 col-md-3">
                                <div class="form-group">
                                    <label for="originalValue">{{ l('OriginalValue') }}</label>
                                    <div class="input-group">
                                        <input
                                            type="text"
                                            [(ngModel)]="originalValue"
                                            name="originalValue"
                                            class="form-control" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6 col-md-3">
                                <div class="form-group">
                                    <label for="newValue">{{ l('NewValue') }}</label>
                                    <div class="input-group">
                                        <input
                                            type="text"
                                            [(ngModel)]="newValue"
                                            name="newValue"
                                            class="form-control" />
                                    </div>
                                </div>
                            </div>

                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label for="description">{{ l('Description') }}</label>
                                    <div class="input-group">
                                        <input
                                            type="text"
                                            [(ngModel)]="description"
                                            name="description"
                                            class="form-control" />
                                    </div>
                                </div>
                            </div>

                            <div class="d-flex align-items-center justify-content-end col my-2">
                                <button class="btn btn-primary" (click)="getList()">
                                    <i class="fa fa-sync"></i>
                                    {{ 'Refresh' | localize }}
                                </button>
                            </div>
                        </div>
                        <div class="d-flex align-items-center justify-content-end my-2">
                            <span
                                poll-page-tour-step="4"
                                class="clickable-item text-muted"
                                *ngIf="!advancedFiltersAreShown"
                                (click)="advancedFiltersAreShown = !advancedFiltersAreShown">
                                <i class="fa fa-angle-down"></i>
                                {{ l('ShowAdvancedFilters') }}
                            </span>
                            <span
                                poll-page-tour-step="4"
                                class="clickable-item text-muted"
                                *ngIf="advancedFiltersAreShown"
                                (click)="advancedFiltersAreShown = !advancedFiltersAreShown">
                                <i class="fa fa-angle-up"></i>
                                {{ l('HideAdvancedFilters') }}
                            </span>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="card card-custom gutter-b">
            <div class="card-body">
                <div class="row align-items-center">
                    <!-- <Primeng-Datatable-Start> -->
                    <div class="primeng-datatable-container" [busyIf]="primengTableHelper.isLoading">
                        <p-table
                            [scrollable]="true"
                            scrollHeight="75vh"
                            stripedRows
                            #dataTable
                            sortMode="multiple"
                            (onLazyLoad)="getList($event)"
                            [value]="primengTableHelper.records"
                            [rows]="primengTableHelper.defaultRecordsCountPerPage"
                            [paginator]="false"
                            [lazy]="true"
                            [tableStyle]="{ 'min-width': '50rem' }"
                            [scrollable]="false"
                            [resizableColumns]="primengTableHelper.resizableColumns">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 125px">
                                        {{ 'Actions' }}
                                    </th>
                                    <th style="width: 250px" pSortableColumn="userName">
                                        {{ l('User') }}
                                        <p-sortIcon field="userName"></p-sortIcon>
                                    </th>
                                    <th style="width: 250px" pSortableColumn="propertyName">
                                        {{ l('Property') }}
                                        <p-sortIcon field="propertyName"></p-sortIcon>
                                    </th>
                                    <th style="width: 250px" pSortableColumn="originalValue">
                                        {{ l('OriginalValue') }}
                                        <p-sortIcon field="originalValue"></p-sortIcon>
                                    </th>
                                    <th style="width: 250px" pSortableColumn="newValue">
                                        {{ l('NewValue') }}
                                        <p-sortIcon field="newValue"></p-sortIcon>
                                    </th>
                                    <th style="width: 300px" pSortableColumn="description">
                                        {{ l('Description') }}
                                        <p-sortIcon field="description"></p-sortIcon>
                                    </th>
                                    <th style="width: 100px" pSortableColumn="entityType">
                                        {{ l('Type') }}
                                        <p-sortIcon field="entityType"></p-sortIcon>
                                    </th>
                                    <th style="width: 180px" pSortableColumn="reason">
                                        {{ l('Reason') }}
                                        <p-sortIcon field="reason"></p-sortIcon>
                                    </th>
                                    <th style="width: 125px" pSortableColumn="changeTime">
                                        {{ l('ChangeTime') }}
                                        <p-sortIcon field="changeTime"></p-sortIcon>
                                    </th>
                                </tr>
                            </ng-template>

                            <ng-template pTemplate="body" let-record="$implicit" let-i="rowIndex">
                                <tr>
                                    <td style="width: 125px">
                                        <button
                                            mat-raised-button
                                            color="primary"
                                            (click)="copy(record)">
                                            <i class="fa fa-copy mx-2"></i>
                                            {{ 'Copy' | localize }}
                                        </button>
                                    </td>
                                    <td style="width: 250px">
                                        {{ record.userName }}
                                    </td>
                                    <td style="width: 250px">
                                        {{ record.propertyName }}
                                    </td>
                                    <td style="width: 250px">
                                        <span class="two-line-ellipsis" [title]="record.originalValue">
                                            {{ record.originalValue }}
                                        </span>
                                    </td>
                                    <td style="width: 250px">
                                        <span class="two-line-ellipsis" [title]="record.newValue">
                                            {{ record.newValue }}
                                        </span>
                                    </td>
                                    <td style="width: 300px">
                                        <span class="two-line-ellipsis" [title]="record.description">
                                            {{ record.description }}
                                        </span>
                                    </td>
                                    <td style="width: 100px">
                                        {{ record.entityType }}
                                    </td>
                                    <td style="width: 180px">
                                        {{ record.reason }}
                                    </td>
                                    <td style="width: 125px">
                                        {{ record.changeTime | luxonFormat: 'F' }}
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">
                            {{ l('NoData') }}
                        </div>
                        <div class="primeng-paging-container">
                            <p-paginator
                                [rows]="primengTableHelper.defaultRecordsCountPerPage"
                                #paginator
                                (onPageChange)="getList($event)"
                                [totalRecords]="primengTableHelper.totalRecordsCount"
                                [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage"
                                [showCurrentPageReport]="true"
                                [currentPageReportTemplate]="
                                    'TotalRecordsCount' | localize: primengTableHelper.totalRecordsCount
                                "></p-paginator>
                        </div>
                    </div>
                    <!-- <Primeng-Datatable-End> -->
                </div>
            </div>
        </div>
    </div>
</div>
